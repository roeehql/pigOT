# 🐽프로젝트 소개
 - ***돼지는여행중*** 은 해외여행 중 사용한 식비를 기록하면 한국 돈으로 환전된 금액과 누적된 금액을 보여주는 식비 기록 금융 서비스입니다. 
 - 개인프로젝트로 진행되었고, 서버부분은 React교재를 참고해 구현했습니다.
 - 리팩토링한 프로젝트로 리팩토링 전이 궁금하시다면 [돼지는 여행중 : 노션링크](https://bubble-account-b8f.notion.site/0ef07988d4264a48a55f4109d4255e7f) 를 참고해주세요.
 
 <br />
 
 ---
 
 ## 🖊️블로그 글
 
 리팩토링 과정을 기록했습니다.
 
 [돼지는 여행중 리팩토링](https://velog.io/@tae2u2/series/%EB%8F%BC%EC%A7%80%EB%8A%94-%EC%97%AC%ED%96%89-%EC%A4%91-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81)
 
 ---
 
 ## ✅구현 요구사항 목록
 
 처음 리팩토링을 계획할 때 블로그에 남긴 계획서를 기준으로 삼았습니다.<br />
 [리팩토링 계획서: 벨로그 링크 연결](https://velog.io/@tae2u2/%EA%B0%9C%EC%9D%B8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81-%EA%B3%84%ED%9A%8D%EC%84%9C)

- 소스코드 변경
   - [x] 새로운 언어와 프레임워크 도입, 트리구조 변경
   - [x] 변수, 함수, 파일 명 직관적이게 변경
   - [x] CSS 선택자 class명 디렉토리명+BEM 방식으로 통일
   - [x] 동적 import 적용
   - [ ] useCallBack , useMemo 활용해 결과 값 재활용 : _tanstack-query 적용으로 인한 필요성 저하로 기각했습니다._ 
   - [x] 자식들의 속성이 같은 부모 태그들 통일
- UI적 변경
   - [x] 웹 환경에선 웹에 유리하게 와이드한 화면, 모바일 환경에선 센터 중심의 화면으로 구현
   - [x] atomic 디자인 적용 , 알림창과 로딩 중 표시 구현
   - [ ] 외부 폰트 적용 미루기 : _기본 폰트위주로 사용해서 변경하지 않았습니다._

 
 ---
 
 ## 설치, 환경설정 및 실행 방법
 
 ```
 //설치 후 /taeistory 경로에서 입력
 
 npm run dev
 
 npm run start
 
 ```

 
 ---
 
 # 🐽시연화면
 
 <br />

## 로그인(path : "/")

https://user-images.githubusercontent.com/74426470/200272039-d93dcffa-3613-4d80-af13-164cd91efe35.mp4
<table><tr>
<td nowrap><b>로그인 없이 <br />둘러보기</b></td>
<td>로그인 없이 둘러보기 버튼은 이메일인증이 구현되어 있어서 인사 담당자분들과 제 프로젝트를 구경하는 분들의 개인정보 보호와 번거로움을 최소화하기 위해 구현했습니다. </td></tr>
<tr>
<td nowrap><b>로그인</b></td>
<td>로그인한 사용자 정보는 암호화되어 쿠키에 보관되고, 사용됩니다.</td>
</tr>
<tr>
<td nowrap><b>알림</b></td>
<td>로그인 또는 비밀번호가 입력되지 않았을 시, 없는 계정일 시, 비밀번호가 틀렸을 시 알림이 나타납니다. 화면에서 알림이 잘려진 이유는 화질을 위해 화면을 확대해서 녹화했기 때문입니다. 알림은 sweetalert2를 이용해 구현했습니다.</td>
</tr>
</table>

<br />

## 비번찾기(path : "/")
https://user-images.githubusercontent.com/74426470/200272256-95aa9da7-e1cd-4966-ba0e-c57c4161fc08.mp4
<table>
<tr>
<td nowrap><b>비밀번호 <br />찾기</b></td>
<td>버튼을 누르면 이메일인증을 위한 모달이 열립니다. </td></tr>
<tr><td nowrap><b>이메일 인증</b></td>
<td>계정을 입력하면 회원여부를 파악해서 비회원이면 알리고, 회원일 시 메일이 보내집니다. 서버에서 응답해준 5자리 난수와 입력된 인증번호의 일치여부를 확인합니다.</td>
</tr>
<tr>
<td nowrap><b>닫기</b></td>
<td>실수로 닫기 버튼을 눌렀을 가능성을 고려해 지금 나가면 처음부터 다시 해야함을 알리는 confirm알림이 뜨게 설정했습니다. 처음부터 다시 버튼을 누르면  입력값들이 초기화 됩니다.</td>
</tr>
<tr>
<td nowrap><b>비밀번호 <br />변경</b></td>
<td>번호가 일치하면 비밀번호를 변경할 수 있습니다. 비밀번호를 다르게 입력하면 전체 값이 지워지도록 했습니다. 바르게 입력하면 비밀번호가 변경됩니다.</td>
</tr>
</table>
<br />

## 회원가입(path : "/auth")
https://user-images.githubusercontent.com/74426470/200272242-5f2cb13d-6206-4b40-8ef4-b74ff40d3da5.mp4
<table>
<tr>
<td nowrap><b>회원가입<br /> 버튼 클릭</b></td>
<td>회원가입 경로로 이동합니다. 이메일인증을 위한 화면이 가장 먼저 노출됩니다.</td>
</tr>
<tr>
<td nowrap><b>이메일 인증</b></td>
<td>회원가입용 이메일인증은 회원이면 알리고 비회원일 시 이메일을 . 이후 번호확인은 비밀번호 찾기때와 동일한 로직을 사용했습니다.</td>
</tr>
<tr>
<td nowrap><b>회원가입</b></td>
<td>인증된 이메일 값이 폼으로 넘어와 고정값(readOnly)이 됩니다. 변경을 시도하면 다시 이메일인증해야한다는 알림이 뜨게 해두었습니다. 빈칸이 있을 경우, 비밀번호를 서로 다르게 입력했을 경우에도 알림이 뜹니다. 알맞게 입력하면 회원가입이 진행되고, 로그인 화면으로 이동합니다.</td>
</tr>
</table>
<br />
<br />

## 콘텐츠리스트와 입력폼(path : "/home")
https://user-images.githubusercontent.com/74426470/200272282-e17c2887-7d03-4f26-9573-5ddd0bd17597.mp4
<table>
<tr>
<td nowrap><b>첫화면</b></td>
<td>첫화면이 로딩되면서 콘텐츠들과 총 누적금액, 나라들 리스트, 그리고 입력창에서 보여져야할 나라목록을 불러옵니다.</td>
</tr>
<tr>
<td nowrap><b>입력</b></td>
<td>날짜는 당일 날짜가 max값으로 지정되어있고, 나라선택목록은 아래 그림과 같은 알파벳 순서로 나열되어 있습니다. 목록은 [화폐단위 : "KRW" , 나라이름 : "KOREA"] 로 보여집니다. 나라가 선택되면 api를 이용해 해당국가의 환율을 받아오고, 금액을 입력하면 계산된 원기준 금액을 바로 확인할 수 있습니다. 게시글이 입력되면 리스트와 누적금액, 나라가 업데이트 됩니다.</td>
</tr>
<tr>
<td nowrap><b>*참고이미지</b></td><td><img src="https://user-images.githubusercontent.com/74426470/200505106-9be71082-8279-4bc4-a050-9bc706520c5b.png" alt="나라목록" width="300px" />
</td>
</tr>
<tr>
<td nowrap><b>리스트 UI</b></td>
<td>리스트 UI는 '여행경비정리'를 검색하면 대부분의 분들이 엑셀폼과 같은 형식이 많이 보여서 테이블로 변경했습니다. 10개씩 잘라서 페이징했던 기존 방식을 없애고 나라별로 볼 수 있게하고, 스크롤 방식으로 바꾸었습니다. 해당항목을 우클릭하면 간편하게 삭제할 수 있습니다.</td>
</tr>
</table>
<br />

## 상세화면(path : "/contents/[id]")
https://user-images.githubusercontent.com/74426470/200272314-03c794f5-f411-4872-b362-4b5a9ee276bf.mp4
<table>
<tr>
<td nowrap><b>첫화면</b></td>
<td>항목을 클릭하면 상세화면으로 이동됩니다. 표에서 바로 볼 수 없었던 입력한 사진과 코멘터리를 볼 수 있고, 수정과 삭제를 진행할 수 있습니다.</td>
</tr>
<tr>
<td nowrap><b>수정</b></td>
<td>수정폼은 기존 입력폼과 동일하고, 기존 값이 초기값으로 지정되어 있습니다. 모든 항목을 수정할 수 있지만 나라나 날짜를 변경하면 금액을 다시 입력해주어야 한다는 아쉬운 점이 있습니다. 수정이 완료되면 수정화면이 닫히고 다시 바뀐 값들이 초기 값으로 지정됩니다.</td>
</tr>
<tr>
<td nowrap><b>삭제</b></td>
<td>삭제여부를 묻고 삭제 시 다시 리스트로 돌아갑니다.</td>
</tr>
</table>

<br />

## 마이페이지(path : "/mypage")
https://user-images.githubusercontent.com/74426470/200272353-4babd2ca-a80a-4a96-b091-d17dba5ce0ca.mp4
<table>
<tr>
<td nowrap><b>첫화면</b></td>
<td>회원정보에선 별명과 계정을 확인할 수 있고, 탈퇴할 수 있습니다.</td>
</tr>
<tr>
<td nowrap><b>별명 수정</b></td>
<td>별명을 수정할 수 있지만 별명이 다른 컴포넌트에서 사용되지 않아 큰 의미가 없어진 기능입니다. 그래서 수정된 별명을 다시 불러오는 api가 과도하다는 생각이 들어 재로그인 전까진 localstorage로 수정된 별명이 보여지게 설정했습니다.</td>
</tr>
<tr>
<td nowrap><b>탈퇴</b></td>
<td>탈퇴는 탈퇴여부를 다시 묻고, 바로 탈퇴할 수 있습니다. 탈퇴 시 관련 모든 데이터가 지워집니다.</td>
</tr>
</table>
<br />

## Header & footer (path: _app(전역))

<table>
<tr>
<td nowrap><b>세션이 없는 <br />헤더</b></td>
<td>헤더는 세션여부에 따라 2가지 버전으로 나뉩니다. 첫화면에서 헤더는 로고와 로그인/회원가입을 보여줍니다. 여기선 로고를 클릭해도 "/" 경로로 이동됩니다. </td>
</tr>
<tr>
<td nowrap><b>세션이 있는 <br />헤더</b></td>
<td>로고를 클릭하면 /home 경로로 이동할 수 있고, 회원정보로 이동할 수 있으며 로그아웃이 가능합니다. 회원정보 버튼은 별명이 보이게 설정했었는데 사용자 입장에서 회원정보를 볼 수 있는 것을 인지하지 못할 수도 있다는 생각이 들어 회원정보로 변경했습니다. 이 과정에서 별명 수정 기능이 무의미해져서 별명을 이대로 축소시킬지 아니면 활용할 다른 방안을 생각할지는 아직 고민 중입니다.</td>
</tr>
<tr>
<td nowrap><b>로그아웃</b></td>
<td>로그아웃하면 저장된 쿠키가 지워지며 다시 "/"경로로 이동합니다.</td>
</tr>
<tr>
<td nowrap><b>footer</b></td>
<td>큰 의미는 없지만 오류를 알려주고 싶은 분들을 위해 저의 깃헙주소를 넣어두었습니다.</td></tr>
</table>

## 비정상접근 및 에러처리 화면
<img src="https://user-images.githubusercontent.com/74426470/200244086-245c0216-23f0-4c37-a73e-01eb3c0ab9ce.png" alt="list error preview" width="700px" />
 
 - get요청으로 불러오는 부분에서 에러가 발생하면 알림메세지와 함께 요청을 재시도할 수 있는 버튼을 만들어 두었습니다.
 
 <br />
 
 
<img src="https://user-images.githubusercontent.com/74426470/200244051-f8e5e442-a8e7-431e-9bfb-a1a79dc506b6.png" alt="warning preview" width="700px" />

 - 비회원이나 비로그인회원이 /home 경로로 접근하면 경고화면이 뜨면서 다시 / 경로로 이동시킵니다. admin 화면에 접근해도 동일한 화면이 나타나고 /home 경로로 이동시키며, mypage에 접근하면 회원가입을 권유하는 화면이 보여집니다.

---

 ## ➡️사용된 기술 스택과 라이브러리 및 프레임워크
 
 <table border><tr><td>typescript </td><td>타입스크립트의 가장 좋은 점은 서버에서 가져온 데이터를 믿을 수 있게 해준다는 것입니다. 객체안에 이름을 interface에 입력해두면 외우지 않아도 vscode가 알려주는 점이 가장 좋았습니다. 서버에서 받아오는 데이터의 타입을 인지한채로 개발하는 개인프로젝트에선 타입을 지정하는 것이 수월하기 때문에 타입스크립트를 사용하지 않을 이유가 없었습니다.</td></tr>
<tr> <td>tanstack-query</td>
<td>api통신으로 받아오는 서버데이터 위주의 프로젝트라면 유용할 것이라는 글을 보고 사용해보았습니다. 경험한 후기는 일단 정말 쉽고, 코드가 많이 줄어듭니다. 그리고 컴포넌트에서 쉽게 에러와 로딩 처리할 수 있는 것과 만들어둔 커스텀훅에 적용하는 것이 편리해서 좋았습니다. 특히 useMutate를 통해 데이터가 수정될 시 쿼리무효화(코드 1줄)만으로 간편하게 데이터를 다시 불러올 수 있어서 오직 재호출만을 위해 사용하던 전역변수들을 지울 수 있어서 좋았습니다.다만 Promise타입지정을해도 tanstack-query가 무조건 undefined를 달고 오는 것은 좀 곤란했습니다.</td></tr>
<tr> <td>next.js</td>
<td>router설정이 필요없는 점과 SSR이 도입이유였습니다. 서버를 고성능으로 구현할 수 없는 상황에서 조금이라도 FCP를 줄여보고자 선택했습니다.</td></tr>
<tr> <td>redux-toolkit , redux-thunk</td>
<td>여러 컴포넌트에서 재사용이 요구되는 사용자의 정보를 비동기 + 전역으로 다루어야겠다고 생각해서 상태관리 라이브러리들 중 무엇을 사용할지 고민했고, 비동기 데이터를 전역으로 다뤄보는 것은 처음이어서 예시와 강의를 찾을 수 있었던 리덕스를 선택했습니다. 툴킷은 코드가 훨씬 간편했고, 기존 리덕스의 컨셉을 유지해서 이해하기도 좋았습니다.</td></tr>
<tr> <td>react-cookie</td>
<td>react-cookies를 사용 했는데 마지막 업데이트가 2019년이고, react-cookie가 사용자수도 훨씬 많아서 대세를 따르기로 했습니다. hook으로 사용할 수도 있는 것이 장점이지만 이 프로젝트에선 쿠키를 ts파일안에서 다루고 있기에 저는 일반함수로 이용했습니다. 그래서 사용법도 비슷했고, 큰 차이는 없었지만 react-cookies가 서비스 종료할지도 모른다는 불안감에서 해방되었습니다.</td></tr>
<tr> <td>axios</td>
<td>axios는 전달하는 객체를 변환하지 않아도 된다는 장점때문에 꾸준히 사용하고 있습니다.</td></tr>
</table>
 
---

## ✅폴더 구조 설명

#### 폴더를 구분한 기준
 - 다수의 사람들이 ‘~파일은 ~폴더에 있겠다.’ 고 유추할 수 있게 나누는 것을 목표로 삼았습니다.
 - 많은 파일이 몰리는 폴더는 생산성을 고려해 기능별로 세분화하고, 재사용이 잦은 파일들은 상단에 두었습니다.
 
<table><tr><td>api</td><td>api들을 객체로 묶어 서버 route를 기준으로 나눠두었습니다.</td></tr>
<tr><td>atomic</td><td>재사용이 잦은 atom 컴포넌트들인 input, button, loading 컴포넌트를 모아두었고, 일반 컴포넌트들과 같은 scss 파일에서 스타일을 지정하면 수정 시 위치를 찾기도 어렵고, 모든 파일에 붙여넣기를 해야해서 style파일을 여기에 따로 만들었습니다.</td></tr>
<tr><td>components</td><td>admin , auth, contents, user 기능별로 컴포넌트들을 나누어 두었습니다.</td></tr>
<tr><td>constant</td><td>tanstack-query , react-cookie에서 사용되는 문자열 상수들을 모아두었습니다.</td></tr>
<tr><td>hooks </td><td>대부분의 커스텀훅들이 재사용성이 높지 않아서 뭉쳐둘 이유가 없었기에 각 컴포넌트 내부 폴더로 옮겼다가 오히려 위치가 애매해지는 훅들이 생겨나 import문을 통해 개발자가 찾기 쉽도록 절대경로를 설정하고, 기능별로 나누어두었습니다.</td></tr>
<tr><td>pages</td><td>하나의 인덱스로 구현하려다가 NextJS의 라우팅 시스템을 조금이라도 다뤄보기위해 기능별로 경로를 나누어보았습니다.</td></tr>
<tr><td>store</td><td>redux-thunk store와 slice들이 들어있습니다.</td></tr>
<tr><td>styles</td><td>module.scss로 작성했습니다.</td></tr>
<tr><td>types</td><td>타입들을 모아두었습니다.</td></tr>
<tr><td>util</td><td>라이브러리(reactcookie, sweetalert2)를 사용하기 위한 함수와 오늘날짜 받아오는 함수, 금액에 콤마 붙여주는 함수, 쿠키제거함수와 같은 값이 변하지 않는 재사용 함수들을 모아두었습니다.</td></tr>
</table>

---

## ✅리팩토링 진행 시 주안점

 1. 새로운 언어와 프레임워크를 적극적으로 도입할 것
 2. 라이브러리를 접목할 때 '좋다는 말이 많아서'가 아닌 기술적 이유를 가질 것
 3. 이름(변수명, 함수명, 생성자명, 파일명, 폴더명)을 최대한 직관적으로 작성할 것
 4. 컴포넌트 내 동일수준 추상화를 유지할 것
 5. 뷰와 로직을 최대한 분리할 것
 6. 다음 리팩토링을 한다는 전제를 가질 것

---

## ➡️한계점 및 개선사항

 1. 성능 : 기존 프로젝트 Fast3G 기준 FCP가 40초였어서 이번에 NextJS를 도입해본 것인데 지원하는 dynamic import를 이용해 8초로 줄였지만 그럼에도 lightHouse 기준 성능점수는 45점이었습니다. 40초였지만 71점이었던 것을 생각하면 초기번들의 크기를 줄이는 것만으로는 성능을 높일 수 없는 것 같습니다. localhost와 heroku라는 환경적 차이도 있었지만 MYSQL 벤치에서 쿼리문을 사용해 데이터를 직접적으로 출력하는 시간 자체가 오래걸려서 이미지를 긴 문자열로 변환해서 처리하는 방식과 서버코드 자체가 가지는 둔탁함도 큰 원인인 것 같습니다. 서버를 firebase나 prisma로 바꾸는 방법을 고려해서 개인의 부족함을 개선해볼 계획입니다.
 
 
 ---
 
 ## 🔅 배운점
 
  1. 추상화와 코드 분리, 재사용성에 대해 고민하며 코드를 작성하게 되었습니다. 
  2. 새로운 기술들을 마주하는 태도가 적극적으로 변했고, 공식문서를 보면서 학습하는 방법에 대한 감을 잡게 되었습니다.
 
 ---
 
읽어주셔서 감사합니다:)

